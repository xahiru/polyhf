<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">

<dom-module id="my-view6">
  <template>
    <style include="shared-styles">
    :host {
      display: block;

      padding: 10px;
    }
    div#listbox {
    border: 1px solid #e5e5e5;
    }
  </style>

  <style>
  td, th {
    padding: 8px;
    box-sizing: border-box;
    white-space: nowrap;
  }
  td:nth-of-type(1),
  th:nth-of-type(1) {
    background-color: rgba(255, 0, 255, 0.2);
  }
  tr.iron-selected td {
    background-color: rgba(0, 0, 0, 0.1);
  }
  tr:hover td {
    background-color: rgba(0, 0, 0, 0.2);
  }
  tr td.iron-selected:not(:nth-of-type(1)) {
    background-color: rgba(255, 255, 0, 0.2);
  }
</style>

  <div class="card">
    <div class="circle">6</div>
    <h1>Deliver</h1>

    <iron-ajax
    id="ajax"
    auto
    url="http://xahiru.local:3000/api/items?access_token=6Nb2ti5QEXIoDBS5FQGWIz4poRFiBCMMYJbYXSGHWuulOuy0GTEuGx2VCEVvbpBK"
    method="get"
    last-response="{{itemstokens}}"
    handle-as="json">
  </iron-ajax>
  <form is = "iron-form" method = "get" action = "/" id = "basic"  content-type="application/json">
    <paper-dropdown-menu label="PO" on-selected-item-changed="_pochanged">
      <paper-listbox id="selectedPo6" slot="dropdown-content" selected="1">
        <dom-repeat items="{{itemstokens}}">
          <template>
            <template is="dom-if" if="[[_typecheck(item.type)]]">
              <paper-item value$="{{item}}">{{item.id}}</paper-item>
            </template>
          </template>
        </dom-repeat>
      </paper-listbox>
    </paper-dropdown-menu>
    <br>
    <br>
    <div  id="listbox">
      <paper-item> 
        <paper-item>
          Name
        </paper-item>
        <paper-item>
          Quantity
        </paper-item>
        <paper-item>
          Total
        </paper-item>
        <paper-item>
          Batch ID 
        </paper-item>
        <paper-item>
          Amount
        </paper-item>
        <paper-item>
          Status
        </paper-item>
      </paper-item>
      <dom-repeat items="{{mypo.details}}" index-as="item_no">
          <template>
        
        <dom-repeat items="{{item.batches}}" as="batches" index-as="batch_no">
          <template>
            <paper-item value$="{{item.name}}">
        <paper-checkbox name="{{item.type}}" value="{{item.type}}" checked> </paper-checkbox>
        <paper-item>
          {{item.name}}
        </paper-item>
        <paper-item>
          {{item.amount}}
        </paper-item>
        <paper-item>
          {{item.total}}
        </paper-item>
        <paper-item>
          Batch ID 
        </paper-item>

        <paper-item>
          Amount
        </paper-item>
        <paper-item>
          Status
        </paper-item>
            <paper-item> {{batches.batch}} </paper-item>
          </paper-item>
          </template>
        </dom-repeat>

             
          </template>
        </dom-repeat>
    </div>
    <br>
    <br>

    <vaadin-grid theme="row-dividers" items="[[mypo.details]]" column-reordering-allowed multi-sort>

    <vaadin-grid-selection-column auto-select frozen> </vaadin-grid-selection-column>

      <vaadin-grid-column width="30px" flex-grow="0" >
        <template>
          <paper-checkbox aria-label="Select Row" checked="{{selected}}">
        </paper-checkbox></template>
      </vaadin-grid-column>

      <vaadin-grid-column width="9em">
        <template class="header">Name</template>
        <template>[[item.name]]</template>
      </vaadin-grid-column>

      <vaadin-grid-column width="9em">
        <template class="header">
          Quantity
        </template>
        <template>[[item.amount]]</template>
      </vaadin-grid-column>

      <vaadin-grid-column width="9em">
        <template class="header">
          Total
        </template>
        <template>[[item.total]]</template>
      </vaadin-grid-column>

      <vaadin-grid-column width="15em">
        <template class="header">
         Batches
        </template>
        <template>

           <dom-repeat items="{{item.batches}}" as="batch" index-as="batch_no">
              <template>
                 <template is="dom-if" if="[[_indexcheck(batch_no)]]">
                 <paper-item> <paper-item>batchid</paper-item> <paper-item>amount</paper-item> <paper-item>status</paper-item> </paper-item>
                </template>
                  <paper-item>
                      <paper-item> <paper-checkbox></paper-checkbox>[[batch.batch]]</paper-item> <paper-input id="amnt"> [[batch.amount]]</paper-input> <paper-item> [[_getStatus(batch.status)]]</paper-item>
                 </paper-item>
              </template>
            </dom-repeat>
        </template>
      </vaadin-grid-column>

    </vaadin-grid>


        <br>
         <paper-button class = "paperbtn" raised on-click = "_submit">Recieve</paper-button>
         <h4>Transaction details:</h4>
         <div class = "output"></div>
      </form>


    <paper-button id="btnDeliver" class = "paperbtn" raised on-click = "deliverItem">Deliver</paper-button>
    <br>

    <h4>Order status:</h4>
    <div class = "output"></div>
  </form>
  
</div>

</template>

<script>
  class MyView6 extends Polymer.Element {
    static get is() { return 'my-view6'; }
    static get properties() {
      return {
        itemstokens: {
          type: Array,
          notify: true,
          value: function() {
            return [];
          },
          mypo:{
            type: Object,
            value: function(){
              return[];
            },
            observer: '_pochanged'
          }
        }
      }
    }


    _pochanged(e){
      var index = 0;
      for (var i = 0; i < this.itemstokens.length; i++) {
       if(this.itemstokens[i].id == e.target.value){
          index = i;
       } 
      }
      // var tech = [];
      // tech[0] = this.itemstokens[index];
      // this.mypo = tech;
     this.mypo = this.itemstokens[index]
     // console.log(this.mypo.details);
      // this.mypo = this.itemstokens;
      // console.log(tech);
      // console.log(this.itemstokens);

    }

    _typecheck(s){
      if (s == 'po') {
          // console.log("ttthru");
          return true;

        } else {
          // console.log("falllse");
          return false;
        }

      }
      ready(){
        super.ready();
        // if(this.itemstokens == null){
        //   this.mypo = this.itemstokens[0];
        //   console.log(mypo);
        // }
      }
    }

    window.customElements.define(MyView6.is, MyView6);
  </script>
</dom-module>
